variables_2000 <- colnames(nesi_individuals_with_grants_2000)
variables_1998 <- colnames(nesi_individuals_with_grants_1998)
variables_1996 <- colnames(nesi_individuals_with_grants_1996)
variables_1994 <- colnames(nesi_individuals_with_grants_1994)
variables_1992 <- colnames(nesi_individuals_with_grants_1992)
variables_1990 <- colnames(nesi_individuals_with_grants_1990)
#######
nesi_individuals_with_grants_2015_desc$available_2013 <- ifelse(variables_2015 %in% variables_2013, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2011 <- ifelse(variables_2015 %in% variables_2011, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2009 <- ifelse(variables_2015 %in% variables_2009, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2006 <- ifelse(variables_2015 %in% variables_2006, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2003 <- ifelse(variables_2015 %in% variables_2003, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2000 <- ifelse(variables_2015 %in% variables_2000, 1, 0)
nesi_individuals_with_grants_2015_desc$available_1998 <- ifelse(variables_2015 %in% variables_1998, 1, 0)
nesi_individuals_with_grants_2015_desc$available_1996 <- ifelse(variables_2015 %in% variables_1996, 1, 0)
nesi_individuals_with_grants_2015_desc$available_1994 <- ifelse(variables_2015 %in% variables_1994, 1, 0)
nesi_individuals_with_grants_2015_desc$available_1992 <- ifelse(variables_2015 %in% variables_1992, 1, 0)
nesi_individuals_with_grants_2015_desc$available_1990 <- ifelse(variables_2015 %in% variables_1990, 1, 0)
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_1[,-1]
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_2[,-1]/(nesi_individuals_with_grants_2015_desc_1[,-1]+nesi_individuals_with_grants_2015_desc_2[,-1])
nesi_individuals_with_grants_2015_desc <- round(nesi_individuals_with_grants_2015_desc, digits = 4)
nesi_individuals_with_grants_2015_desc <- as.data.frame(nesi_individuals_with_grants_2015_desc)
nesi_individuals_with_grants_2015_desc <- as.data.frame(t(nesi_individuals_with_grants_2015_desc))
setnames(nesi_individuals_with_grants_2015_desc, colnames(nesi_individuals_with_grants_2015_desc), "reply_ratio_2015")
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_1[,-1]
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_2[,-1]/(nesi_individuals_with_grants_2015_desc_1[,-1]+nesi_individuals_with_grants_2015_desc_2[,-1])
nesi_individuals_with_grants_2015_desc <- round(nesi_individuals_with_grants_2015_desc, digits = 4)
nesi_individuals_with_grants_2015_desc <- as.data.frame(nesi_individuals_with_grants_2015_desc)
nesi_individuals_with_grants_2015_desc <- as.data.frame(t(nesi_individuals_with_grants_2015_desc))
setnames(nesi_individuals_with_grants_2015_desc, colnames(nesi_individuals_with_grants_2015_desc), "reply_ratio_2015")
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_1[,-1]
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_2[,-1]/(nesi_individuals_with_grants_2015_desc_1[,-1]+nesi_individuals_with_grants_2015_desc_2[,-1])
nesi_individuals_with_grants_2015_desc <- round(nesi_individuals_with_grants_2015_desc, digits = 4)
nesi_individuals_with_grants_2015_desc <- as.data.frame(nesi_individuals_with_grants_2015_desc)
nesi_individuals_with_grants_2015_desc <- as.data.frame(t(nesi_individuals_with_grants_2015_desc))
setnames(nesi_individuals_with_grants_2015_desc, colnames(nesi_individuals_with_grants_2015_desc), "reply_ratio_2015")
variables_2015 <- rownames(nesi_individuals_with_grants_2015_desc)
variables_2014 <- colnames(nesi_individuals_with_grants_2014)
variables_2013 <- colnames(nesi_individuals_with_grants_2013)
variables_2012 <- colnames(nesi_individuals_with_grants_2012)
variables_2011 <- colnames(nesi_individuals_with_grants_2011)
variables_2010 <- colnames(nesi_individuals_with_grants_2010)
nesi_individuals_with_grants_2015_desc$available_2014 <- ifelse(variables_2015 %in% variables_2014, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2013 <- ifelse(variables_2015 %in% variables_2013, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2012 <- ifelse(variables_2015 %in% variables_2012, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2011 <- ifelse(variables_2015 %in% variables_2011, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2010 <- ifelse(variables_2015 %in% variables_2010, 1, 0)
write.csv(nesi_individuals_with_grants_2015_desc, file = "describe_dataset/4_csv_files/aggregate_description_2015.csv")
source("describe_dataset/3_description/aggregate_description.R")
source("describe_dataset/1_functions/1_load_functions.R")
source("describe_dataset/1_functions/6_normalization.R")
source("describe_dataset/2_clean/1_clean_2015.R")
source("describe_dataset/1_functions/1_load_functions.R")
source("describe_dataset/1_functions/6_normalization.R")
source("describe_dataset/2_clean/1_clean_2015.R")
nesi_individuals_with_grants_2015_c_1 <- nesi_individuals_with_grants_2015 %>% group_by(R_P_C) %>% summarise_each(funs(sum(is.na(.) | .==0 | .=="" | .==" ")))
nesi_individuals_with_grants_2015_c_1
names(nesi_individuals_with_grants_2015_c_1)
setnames(nesi_individuals_with_grants_2015_c_1, "R_P_C", "comuna_name")
nesi_individuals_with_grants_2015_p_1 <- nesi_individuals_with_grants_2015_c_1
nesi_individuals_with_grants_2015_p_1 <- join(nesi_individuals_with_grants_2015_p_1, regiones_nesi_individuals_with_grants_2015[,c("comuna_name","provincia_name")], by = "comuna_name")
nesi_individuals_with_grants_2015_p_1 <- move_col(nesi_individuals_with_grants_2015_p_1, c("provincia_name"=1))
nesi_individuals_with_grants_2015_p_1 <- nesi_individuals_with_grants_2015_p_1[,!(names(nesi_individuals_with_grants_2015_p_1) %in% "comuna_name")]
nesi_individuals_with_grants_2015_p_1 <- ddply(nesi_individuals_with_grants_2015_p_1, "provincia_name", numcolwise(sum))
nesi_individuals_with_grants_2015_p_1 <- nesi_individuals_with_grants_2015_c_1
nesi_individuals_with_grants_2015_p_1 <- join(nesi_individuals_with_grants_2015_p_1, regiones_nesi_individuals_with_grants_2015[,c("comuna_name","provincia_name")], by = "comuna_name")
View(region_codes_datachile)
nesi_individuals_with_grants_2015_p_1 <- join(nesi_individuals_with_grants_2015_p_1, regiones_casen_2015[,c("comuna_name","provincia_name")], by = "comuna_name")
source("describe_dataset/1_functions/1_load_functions.R")
source("describe_dataset/1_functions/6_normalization.R")
source("describe_dataset/2_clean/1_clean_2015.R")
nesi_individuals_with_grants_2015_c_1 <- nesi_individuals_with_grants_2015 %>% group_by(R_P_C) %>% summarise_each(funs(sum(is.na(.) | .==0 | .=="" | .==" ")))
setnames(nesi_individuals_with_grants_2015_c_1, "R_P_C", "comuna_name")
#########################
## aggregate by provincia
#########################
nesi_individuals_with_grants_2015_p_1 <- nesi_individuals_with_grants_2015_c_1
nesi_individuals_with_grants_2015_p_1 <- join(nesi_individuals_with_grants_2015_p_1, regiones_casen_2015[,c("comuna_name","provincia_name")], by = "comuna_name")
nesi_individuals_with_grants_2015_p_1 <- move_col(nesi_individuals_with_grants_2015_p_1, c("provincia_name"=1))
nesi_individuals_with_grants_2015_p_1 <- nesi_individuals_with_grants_2015_p_1[,!(names(nesi_individuals_with_grants_2015_p_1) %in% "comuna_name")]
nesi_individuals_with_grants_2015_p_1 <- ddply(nesi_individuals_with_grants_2015_p_1, "provincia_name", numcolwise(sum))
nesi_individuals_with_grants_2015_r_1 <- nesi_individuals_with_grants_2015_c_1
nesi_individuals_with_grants_2015_r_1 <- join(nesi_individuals_with_grants_2015_r_1, regiones_casen_2015[,c("comuna_name","region_name")], by = "comuna_name")
nesi_individuals_with_grants_2015_r_1 <- move_col(nesi_individuals_with_grants_2015_r_1, c("region_name"=1))
nesi_individuals_with_grants_2015_r_1 <- nesi_individuals_with_grants_2015_r_1[,!(names(nesi_individuals_with_grants_2015_r_1) %in% "comuna_name")]
nesi_individuals_with_grants_2015_r_1 <- ddply(nesi_individuals_with_grants_2015_r_1, "region_name", numcolwise(sum))
nesi_individuals_with_grants_2015_c_2 <- nesi_individuals_with_grants_2015 %>% group_by(comuna) %>% summarise_each(funs(sum(!(is.na(.) | .==0 | .=="" | .==" "))))
setnames(nesi_individuals_with_grants_2015_c_2, "R_P_C", "comuna_name")
nesi_individuals_with_grants_2015_c_2 <- nesi_individuals_with_grants_2015 %>% group_by(R_P_C) %>% summarise_each(funs(sum(!(is.na(.) | .==0 | .=="" | .==" "))))
setnames(nesi_individuals_with_grants_2015_c_2, "R_P_C", "comuna_name")
nesi_individuals_with_grants_2015_p_2 <- nesi_individuals_with_grants_2015_c_2
nesi_individuals_with_grants_2015_p_2 <- join(nesi_individuals_with_grants_2015_p_2, regiones_casen_2015[,c("comuna_name","provincia_name")], by = "comuna_name")
nesi_individuals_with_grants_2015_p_2 <- move_col(nesi_individuals_with_grants_2015_p_2, c("provincia_name"=1))
nesi_individuals_with_grants_2015_p_2 <- nesi_individuals_with_grants_2015_p_2[,!(names(nesi_individuals_with_grants_2015_p_2) %in% "comuna_name")]
nesi_individuals_with_grants_2015_p_2 <- ddply(nesi_individuals_with_grants_2015_p_2, "provincia_name", numcolwise(sum))
nesi_individuals_with_grants_2015_r_2 <- nesi_individuals_with_grants_2015_c_2
nesi_individuals_with_grants_2015_r_2 <- join(nesi_individuals_with_grants_2015_r_2, regiones_casen_2015[,c("comuna_name","region_name")], by = "comuna_name")
nesi_individuals_with_grants_2015_r_2 <- move_col(nesi_individuals_with_grants_2015_r_2, c("region_name"=1))
nesi_individuals_with_grants_2015_r_2 <- nesi_individuals_with_grants_2015_r_2[,!(names(nesi_individuals_with_grants_2015_r_2) %in% "comuna_name")]
nesi_individuals_with_grants_2015_r_2 <- ddply(nesi_individuals_with_grants_2015_r_2, "region_name", numcolwise(sum))
nesi_individuals_with_grants_2015_c_pcent <- nesi_individuals_with_grants_2015_c_2
nesi_individuals_with_grants_2015_c_pcent[,-1] <- nesi_individuals_with_grants_2015_c_2[,-1]/(nesi_individuals_with_grants_2015_c_1[,-1]+nesi_individuals_with_grants_2015_c_2[,-1])
nesi_individuals_with_grants_2015_c_pcent[,-1] <- round(nesi_individuals_with_grants_2015_c_pcent[,-1], digits = 4)
setnames(nesi_individuals_with_grants_2015_c_pcent, "comuna_name", "geography_name")
nesi_individuals_with_grants_2015_c_pcent$geography_division <- "comuna"
nesi_individuals_with_grants_2015_c_pcent <- move_col(nesi_individuals_with_grants_2015_c_pcent, c("geography_division"=1))
nesi_individuals_with_grants_2015_p_pcent <- nesi_individuals_with_grants_2015_p_2
nesi_individuals_with_grants_2015_p_pcent[,-1] <- nesi_individuals_with_grants_2015_p_2[,-1]/(nesi_individuals_with_grants_2015_p_1[,-1]+nesi_individuals_with_grants_2015_p_2[,-1])
nesi_individuals_with_grants_2015_p_pcent[,-1] <- round(nesi_individuals_with_grants_2015_p_pcent[,-1], digits = 4)
setnames(nesi_individuals_with_grants_2015_p_pcent, "provincia_name", "geography_name")
nesi_individuals_with_grants_2015_p_pcent$geography_division <- "provincia"
nesi_individuals_with_grants_2015_p_pcent <- move_col(nesi_individuals_with_grants_2015_p_pcent, c("geography_division"=1))
nesi_individuals_with_grants_2015_r_pcent <- nesi_individuals_with_grants_2015_r_2
nesi_individuals_with_grants_2015_r_pcent[,-1] <- nesi_individuals_with_grants_2015_r_2[,-1]/(nesi_individuals_with_grants_2015_r_1[,-1]+nesi_individuals_with_grants_2015_r_2[,-1])
nesi_individuals_with_grants_2015_r_pcent[,-1] <- round(nesi_individuals_with_grants_2015_r_pcent[,-1], digits = 4)
setnames(nesi_individuals_with_grants_2015_r_pcent, "region_name", "geography_name")
nesi_individuals_with_grants_2015_r_pcent$geography_division <- "region"
nesi_individuals_with_grants_2015_r_pcent <- move_col(nesi_individuals_with_grants_2015_r_pcent, c("geography_division"=1))
nesi_individuals_with_grants_2015_all_pcent <- rbind(nesi_individuals_with_grants_2015_c_pcent,nesi_individuals_with_grants_2015_p_pcent,nesi_individuals_with_grants_2015_r_pcent)
nesi_individuals_with_grants_2015_all_pcent[nesi_individuals_with_grants_2015_all_pcent < 0] <- 0
nesi_individuals_with_grants_2015_c_count <- nesi_individuals_with_grants_2015_c_2
nesi_individuals_with_grants_2015_c_count$geography_division <- "comuna"
nesi_individuals_with_grants_2015_c_count <- move_col(nesi_individuals_with_grants_2015_c_count, c("geography_division"=1))
nesi_individuals_with_grants_2015_p_count <- nesi_individuals_with_grants_2015_p_2
nesi_individuals_with_grants_2015_p_count$geography_division <- "provincia"
nesi_individuals_with_grants_2015_p_count <- move_col(nesi_individuals_with_grants_2015_p_count, c("geography_division"=1))
nesi_individuals_with_grants_2015_r_count <- nesi_individuals_with_grants_2015_r_2
nesi_individuals_with_grants_2015_r_count$geography_division <- "region"
nesi_individuals_with_grants_2015_r_count <- move_col(nesi_individuals_with_grants_2015_r_count, c("geography_division"=1))
nesi_individuals_with_grants_2015_all_count <- rbind(nesi_individuals_with_grants_2015_c_count,nesi_individuals_with_grants_2015_p_count,nesi_individuals_with_grants_2015_r_count)
write.csv(nesi_individuals_with_grants_2015_all_pcent, file = "describe_dataset/4_csv_files/geographical_description_percentages_2015.csv")
write.csv(nesi_individuals_with_grants_2015_all_count, file = "describe_dataset/4_csv_files/geographical_description_count_2015.csv")
load("nesi_2015/individuals/nesi_individuals_with_grants_2015.RData")
View(nesi_individuals_with_grants_2015)
libraries <- c("foreign","httr", "data.table", "stringr")
load("nesi_2015/individuals/nesi_individuals_with_grants_2015.RData")
questions_labels <- as.data.frame(attributes(nesi_individuals_with_grants_2015)$variable.labels)
View(questions_labels)
write.csv(questions_labels, file = "describe_dataset/4_csv_files/questions_labels_2015.csv")
source("labour_situation/1_functions/1_load_functions.R")
source("labour_situation/1_functions/5_normalization.R")
source("labour_situation/1_functions/6_batch_load_data.R") #uncomment to recalculate from 0
source("labour_situation/2_process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
View(labour_description_2015)
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
View(labour_description_2015)
summary_2015 <- ddply(labour_description_2015, .(sex,isic), summarise, FUN = matrixStats::weightedMean(wage, w = weigth, na.rm = TRUE))
summary_2015 <- ddply(labour_description_2015, .(sex,isic), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
summary_2015
summary_2015 <- ddply(labour_description_2015, .(sex,isic), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
getwd()
write.csv(summary_2015, file = "summary_sex_isic_2015.csv")
summary_2015_2 <- ddply(labour_description_2015, .(sex,work_day), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
write.csv(summary_2015_2, file = "summary_sex_work_day_2015.csv")
summary_2015_3 <- ddply(labour_description_2015, .(sex,work_day), summarise, FUN = sum)
write.csv(summary_2015_3, file = "summary_sex_work_day_count_2015.csv")
summary_2015_3 <- ddply(labour_description_2015, .(sex,work_day), summarise, FUN = sum)
summary_2015_3 <- ddply(labour_description_2015, .(sex,work_day), summarise, FUN = count)
summary_2015_3 <- ddply(labour_description_2015, .(sex,work_day), summarise, FUN = sum)
summary_2015_3 <- aggregate(sex ~ work_day, labour_description_2015, FUN = sum)
summary_2015_3 <- aggregate(work_day ~ sex, labour_description_2015, FUN = sum)
labour_description_2015$uno <- 1
labour_description_2015$uno <- 1
summary_2015_3 <- aggregate(uno ~ sex + work_day, labour_description_2015, FUN = sum)
write.csv(summary_2015_3, file = "summary_sex_work_day_count_2015.csv")
summary_2015_3
source("labour_situation/1_functions/1_load_functions.R")
source("labour_situation/1_functions/5_normalization.R")
#source("labour_situation/1_functions/6_batch_load_data.R") #uncomment to recalculate from 0
#source("labour_situation/2_process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
View(labour_description_2012)
View(labour_description_2013)
labour_description_2010 <- rbind(labour_description_2010,labour_description_2011,labour_description_2012,
labour_description_2013,labour_description_2014,labour_description_2015)
sex_and_isic_comuna <- ddply(labour_description_2015, .(sex,icse,comuna_name), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
sex_and_isic_comuna
sex_and_icse_comuna <- ddply(labour_description_2015, .(sex,icse,comuna_name), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
sex_and_icse_comuna <- ddply(labour_description_2015, .(sex,icse,comuna_name), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
sex_and_isced_comuna <- ddply(labour_description_2015, .(sex,isced,comuna_name), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
source("labour_situation/1_functions/1_load_functions.R")
source("labour_situation/1_functions/5_normalization.R")
#source("labour_situation/1_functions/6_batch_load_data.R") #uncomment to recalculate from 0
#source("labour_situation/2_process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
labour_description <- rbind(labour_description_2010,labour_description_2011,labour_description_2012,
labour_description_2013,labour_description_2014,labour_description_2015)
source("labour_situation/1_functions/1_load_functions.R")
source("labour_situation/1_functions/5_normalization.R")
#source("labour_situation/1_functions/6_batch_load_data.R") #uncomment to recalculate from 0
#source("labour_situation/2_process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
labour_description <- rbind(labour_description_2010,labour_description_2011,labour_description_2012,
labour_description_2013,labour_description_2014,labour_description_2015)
rm(labour_description_2010,labour_description_2011,labour_description_2012,
labour_description_2013,labour_description_2014,labour_description_2015)
sex_and_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
sex_and_icse_comuna
sex_and_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
sex_and_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
sex_and_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
sex_and_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
sex_and_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
source("labour_situation/1_functions/1_load_functions.R")
source("labour_situation/1_functions/5_normalization.R")
#source("labour_situation/1_functions/6_batch_load_data.R") #uncomment to recalculate from 0
#source("labour_situation/2_process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
weightedmean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weightedmean_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weightedmean_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weightedmean_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weightedmean_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weightedmean_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
labour_description <- rbind(labour_description_2010,labour_description_2011,labour_description_2012,
labour_description_2013,labour_description_2014,labour_description_2015)
rm(labour_description_2010,labour_description_2011,labour_description_2012,
labour_description_2013,labour_description_2014,labour_description_2015)
source("2_statistics_at_comuna_level.R")
source("4_descriptive_statistics/2_statistics_at_comuna_level.R")
source("labour_situation/4_descriptive_statistics/2_statistics_at_comuna_level.R")
weightedmean_sex_icse_comuna
weighted_mean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_company_size_comuna
View(weighted_mean_sex_icse_comuna)
View(labour_description)
weighted_mean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_work_day_comuna
write.csv(weighted_mean_sex_icse_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_icse_comuna.csv")
write.csv(weighted_mean_sex_icse_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_icse_comuna.csv")
write.csv(weighted_mean_sex_isced_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_isced_comuna.csv")
write.csv(weighted_mean_sex_isco_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_isco_comuna.csv")
write.csv(weighted_mean_sex_isic_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_isic_comuna.csv")
write.csv(weighted_mean_sex_work_day_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_work_day_comuna.csv")
write.csv(weighted_mean_sex_company_size_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_company_size_comuna.csv")
weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
write.csv(weighted_mean_sex_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_comuna.csv")
source("labour_situation/1_functions/1_load_functions.R")
source("labour_situation/1_functions/5_normalization.R")
#source("labour_situation/1_functions/6_batch_load_data.R") #uncomment to recalculate from 0
#source("labour_situation/2_process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
names(weighted_mean_sex_comuna)
weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
source("labour_situation/1_functions/1_load_functions.R")
source("labour_situation/1_functions/5_normalization.R")
#source("labour_situation/1_functions/6_batch_load_data.R") #uncomment to recalculate from 0
#source("labour_situation/2_process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
labour_description <- rbind(labour_description_2010,labour_description_2011,labour_description_2012,
labour_description_2013,labour_description_2014,labour_description_2015)
rm(labour_description_2010,labour_description_2011,labour_description_2012,
labour_description_2013,labour_description_2014,labour_description_2015)
weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
source("labour_situation/1_functions/1_load_functions.R")
source("labour_situation/1_functions/5_normalization.R")
#source("labour_situation/1_functions/6_batch_load_data.R") #uncomment to recalculate from 0
#source("labour_situation/2_process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
labour_description <- rbind(labour_description_2010,labour_description_2011,labour_description_2012,
labour_description_2013,labour_description_2014,labour_description_2015)
rm(labour_description_2010,labour_description_2011,labour_description_2012,
labour_description_2013,labour_description_2014,labour_description_2015)
weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
names(weighted_mean_sex_comuna)
colnames(weighted_mean_sex_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
setnames(weighted_mean_sex_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_icse_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_isced_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_isco_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_isic_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_work_day_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_company_size_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
write.csv(weighted_mean_sex_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_comuna.csv")
write.csv(weighted_mean_sex_icse_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_icse_comuna.csv")
write.csv(weighted_mean_sex_isced_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_isced_comuna.csv")
write.csv(weighted_mean_sex_isco_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_isco_comuna.csv")
write.csv(weighted_mean_sex_isic_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_isic_comuna.csv")
write.csv(weighted_mean_sex_work_day_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_work_day_comuna.csv")
write.csv(weighted_mean_sex_company_size_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_company_size_comuna.csv")
weighted_median_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
setnames(weighted_median_sex_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_icse_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_isced_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_isco_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_isic_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_work_day_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_company_size_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
write.csv(weighted_mean_sex_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_comuna.csv")
write.csv(weighted_mean_sex_icse_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_icse_comuna.csv")
write.csv(weighted_mean_sex_isced_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_isced_comuna.csv")
write.csv(weighted_mean_sex_isco_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_isco_comuna.csv")
write.csv(weighted_mean_sex_isic_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_isic_comuna.csv")
write.csv(weighted_mean_sex_work_day_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_work_day_comuna.csv")
write.csv(weighted_mean_sex_company_size_comuna, file = "labour_situation/csv_intermediate_files/weighted_mean_sex_company_size_comuna.csv")
write.csv(weighted_median_sex_comuna, file = "labour_situation/csv_intermediate_files/weighted_median_sex_comuna.csv")
write.csv(weighted_median_sex_icse_comuna, file = "labour_situation/csv_intermediate_files/weighted_median_sex_icse_comuna.csv")
write.csv(weighted_median_sex_isced_comuna, file = "labour_situation/csv_intermediate_files/weighted_median_sex_isced_comuna.csv")
write.csv(weighted_median_sex_isco_comuna, file = "labour_situation/csv_intermediate_files/weighted_median_sex_isco_comuna.csv")
write.csv(weighted_median_sex_isic_comuna, file = "labour_situation/csv_intermediate_files/weighted_median_sex_isic_comuna.csv")
write.csv(weighted_median_sex_work_day_comuna, file = "labour_situation/csv_intermediate_files/weighted_median_sex_work_day_comuna.csv")
write.csv(weighted_median_sex_company_size_comuna, file = "labour_situation/csv_intermediate_files/weighted_median_sex_company_size_comuna.csv")
weighted_median_sex_comuna
weighted_mean_sex_comuna
weighted_median_sex_comuna
ci_weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean_plyr(wage, weight))
source("labour_situation/1_functions/5_margin_of_error.R")
ci_weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean_plyr(wage, weight))
rm(ci_weighted_mean_sex_comuna)
lb_weightedmean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
lb_weightedmean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
lb_weightedmean_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
lb_weightedmean_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
lb_weightedmean_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
lb_weightedmean_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
lb_weightedmean_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
lb_weightedmean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weightedmean_plyr(wage, weight))
lb_weightedmean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weightedmean_plyr(wage, weight))
lb_weightedmean_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weightedmean_plyr(wage, weight))
lb_weightedmean_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weightedmean_plyr(wage, weight))
lb_weightedmean_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weightedmean_plyr(wage, weight))
lb_weightedmean_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weightedmean_plyr(wage, weight))
lb_weightedmean_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weightedmean_plyr(wage, weight))
weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
setnames(weighted_mean_sex_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_icse_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_isced_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_isco_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_isic_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_work_day_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_company_size_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
weighted_median_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
setnames(weighted_median_sex_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_icse_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_isced_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_isco_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_isic_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_work_day_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_company_size_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
lb_weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean(wage, weight))
lb_weighted_mean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean(wage, weight))
lb_weighted_mean_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean(wage, weight))
lb_weighted_mean_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean(wage, weight))
lb_weighted_mean_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean(wage, weight))
lb_weighted_mean_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean(wage, weight))
lb_weighted_mean_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean(wage, weight))
lb_weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean(wage, weight))
# these function may look awkward but it is the best way to plug them into ddply()
##########
# Median #
##########
lb_weighted_median <- function(data) {
set.seed(1234)
x <- data[,"wage"]
v <- data[,"weight"]
b <- one.boot(x, weights = v, FUN = function(x,w) matrixStats::weightedMedian(x, w = v, na.rm = TRUE), R = 100, student = FALSE)
round(perc(b, 0.025), 0)
}
lb_weighted_median_plyr <- function(x,v) {
set.seed(1234)
b <- one.boot(x, weights = v, FUN = function(x,w) matrixStats::weightedMedian(x, w = v, na.rm = TRUE), R = 100, student = FALSE)
round(perc(b, 0.025), 0)
}
ub_weighted_median <- function(data) {
set.seed(1234)
x <- data[,"wage"]
v <- data[,"weight"]
b <- one.boot(x, weights = v, FUN = function(x,w) matrixStats::weightedMedian(x, w = v, na.rm = TRUE), R = 100, student = FALSE)
round(perc(b, 0.975), 0)
}
ub_weighted_median_plyr <- function(x,v) {
set.seed(1234)
b <- one.boot(x, weights = v, FUN = function(x,w) matrixStats::weightedMedian(x, w = v, na.rm = TRUE), R = 100, student = FALSE)
round(perc(b, 0.975), 0)
}
########
# Mean #
########
lb_weighted_mean <- function(data) {
set.seed(1234)
x <- data[,"wage"]
v <- data[,"weight"]
b <- one.boot(x, weights = v, FUN = function(x,w) matrixStats::weightedMean(x, w = v, na.rm = TRUE), R = 100, student = FALSE)
round(perc(b, 0.025), 0)
}
lb_weighted_mean_plyr <- function(x,v) {
set.seed(1234)
b <- one.boot(x, weights = v, FUN = function(x,w) matrixStats::weightedMean(x, w = v, na.rm = TRUE), R = 100, student = FALSE)
round(perc(b, 0.025), 0)
}
ub_weighted_mean <- function(data) {
set.seed(1234)
x <- data[,"wage"]
v <- data[,"weight"]
b <- one.boot(x, weights = v, FUN = function(x,w) matrixStats::weightedMean(x, w = v, na.rm = TRUE), R = 100, student = FALSE)
round(perc(b, 0.975), 0)
}
ub_weighted_mean_plyr <- function(x,v) {
set.seed(1234)
b <- one.boot(x, weights = v, FUN = function(x,w) matrixStats::weightedMean(x, w = v, na.rm = TRUE), R = 100, student = FALSE)
round(perc(b, 0.975), 0)
}
lb_weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean_plyr(wage, weight))
lb_weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean_plyr(wage, weight))
lb_weighted_mean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean_plyr(wage, weight))
source("labour_situation/1_functions/1_load_functions.R")
source("labour_situation/1_functions/5_normalization.R")
#source("labour_situation/1_functions/6_batch_load_data.R") #uncomment to recalculate from 0
#source("labour_situation/2_process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
labour_description <- rbind(labour_description_2010,labour_description_2011,labour_description_2012,
labour_description_2013,labour_description_2014,labour_description_2015)
rm(labour_description_2010,labour_description_2011,labour_description_2012,
labour_description_2013,labour_description_2014,labour_description_2015)
################
# weighted mean
################
weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
weighted_mean_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
setnames(weighted_mean_sex_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_icse_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_isced_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_isco_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_isic_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_work_day_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_mean_sex_company_size_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
##################
# weighted median
##################
weighted_median_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
weighted_median_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = matrixStats::weightedMedian(wage, w = weight, na.rm = TRUE))
setnames(weighted_median_sex_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_icse_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_isced_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_isco_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_isic_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_work_day_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
setnames(weighted_median_sex_company_size_comuna, c("comuna_name","comuna_datachile_id"), c("geography_name","geography_id"))
weighted_median_sex_company_size_comuna
weighted_mean_sex_company_size_comuna
lb_weighted_mean_sex_comuna <- ddply(labour_description, .(sex,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean_plyr(wage, weight))
lb_weighted_mean_sex_icse_comuna <- ddply(labour_description, .(sex,icse,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean_plyr(wage, weight))
lb_weighted_mean_sex_isced_comuna <- ddply(labour_description, .(sex,isced,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean_plyr(wage, weight))
lb_weighted_mean_sex_isco_comuna <- ddply(labour_description, .(sex,isco,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean_plyr(wage, weight))
lb_weighted_mean_sex_isic_comuna <- ddply(labour_description, .(sex,isic,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean_plyr(wage, weight))
lb_weighted_mean_sex_work_day_comuna <- ddply(labour_description, .(sex,work_day,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean_plyr(wage, weight))
lb_weighted_mean_sex_company_size_comuna <- ddply(labour_description, .(sex,company_size,comuna_name,comuna_datachile_id,year), summarise, FUN = lb_weighted_mean_plyr(wage, weight))
