setnames(nesi_individuals_with_grants_2015, colnames(nesi_individuals_with_grants_2015),
c("year", "wage", "weight", "occupational_situation", "sex", "comuna_name", "icse", "isced", "isco", "isic", "work_day", "usual_working_hours", "company_size"))
# Keep only the people that reported their wage
nesi_individuals_with_grants_2015$wage <- as.numeric(as.character(nesi_individuals_with_grants_2015$wage))
nesi_individuals_with_grants_2015 <- subset(nesi_individuals_with_grants_2015, nesi_individuals_with_grants_2015$wage > 0)
nesi_individuals_with_grants_2015$weight <- as.numeric(as.character(nesi_individuals_with_grants_2015$weight))
# Trim leading/ending whitespace + Fix characters/uppercase
nesi_individuals_with_grants_2015$comuna_name <- gsub("(^|[[:space:]])([[:alpha:]])", "\\1\\U\\2", nesi_individuals_with_grants_2015$comuna_name, perl=TRUE)
nesi_individuals_with_grants_2015$comuna_name <- gsub("^\\s+|\\s+$", "", nesi_individuals_with_grants_2015$comuna_name)
# Fix characters/uppercase
nesi_individuals_with_grants_2015$comuna_name <- gsub("\xe1", "\u00e1", nesi_individuals_with_grants_2015$comuna_name) # a with acute
nesi_individuals_with_grants_2015$comuna_name <- gsub("<e1>", "\u00e1", nesi_individuals_with_grants_2015$comuna_name) # a with acute
nesi_individuals_with_grants_2015$comuna_name <- gsub("<c1>", "\u00c1", nesi_individuals_with_grants_2015$comuna_name) # A with acute
nesi_individuals_with_grants_2015$comuna_name <- gsub("\xe9", "\u00e9", nesi_individuals_with_grants_2015$comuna_name) # e with acute
nesi_individuals_with_grants_2015$comuna_name <- gsub("<e9>", "\u00e9", nesi_individuals_with_grants_2015$comuna_name) # e with acute
nesi_individuals_with_grants_2015$comuna_name <- gsub("\xed", "\u00ed", nesi_individuals_with_grants_2015$comuna_name) # i with acute
nesi_individuals_with_grants_2015$comuna_name <- gsub("<ed>", "\u00ed", nesi_individuals_with_grants_2015$comuna_name) # i with acute
nesi_individuals_with_grants_2015$comuna_name <- gsub("\xf3", "\u00f3", nesi_individuals_with_grants_2015$comuna_name) # o with acute
nesi_individuals_with_grants_2015$comuna_name <- gsub("<f3>", "\u00f3", nesi_individuals_with_grants_2015$comuna_name) # o with acute
nesi_individuals_with_grants_2015$comuna_name <- gsub("\xfa", "\u00fa", nesi_individuals_with_grants_2015$comuna_name) # u with acute
nesi_individuals_with_grants_2015$comuna_name <- gsub("<fa>", "\u00fa", nesi_individuals_with_grants_2015$comuna_name) # u with acute
nesi_individuals_with_grants_2015$comuna_name <- gsub("\xda", "\u00da", nesi_individuals_with_grants_2015$comuna_name) # U with acute
nesi_individuals_with_grants_2015$comuna_name <- gsub("<da>", "\u00da", nesi_individuals_with_grants_2015$comuna_name) # U with acute
nesi_individuals_with_grants_2015$comuna_name <- gsub("\xf1", "\u00f1", nesi_individuals_with_grants_2015$comuna_name) # n with tilde
nesi_individuals_with_grants_2015$comuna_name <- gsub("<f1>", "\u00f1", nesi_individuals_with_grants_2015$comuna_name) # n with tilde
nesi_individuals_with_grants_2015$comuna_name <- gsub("\xfc\xbe\x8c\x96\x98\xbc", "\u00f1", nesi_individuals_with_grants_2015$comuna_name) # n with tilde
nesi_individuals_with_grants_2015$comuna_name <- gsub("\xd1", "\u00d1", nesi_individuals_with_grants_2015$comuna_name) # N with tilde
nesi_individuals_with_grants_2015$comuna_name <- gsub("<d1>", "\u00d1", nesi_individuals_with_grants_2015$comuna_name) # N with tilde
nesi_individuals_with_grants_2015$comuna_name <- gsub("\xfc\xbe\x8c\x96\x90\xbc", "\u00d1", nesi_individuals_with_grants_2015$comuna_name) # N with tilde
nesi_individuals_with_grants_2015$comuna_name <- gsub("\xb4", "\u0027", nesi_individuals_with_grants_2015$comuna_name) # apostrophe
nesi_individuals_with_grants_2015$comuna_name <- gsub("<b4>", "\u0027", nesi_individuals_with_grants_2015$comuna_name) # apostrophe
nesi_individuals_with_grants_2015$comuna_name <- gsub(" De ", " de ", nesi_individuals_with_grants_2015$comuna_name)
nesi_individuals_with_grants_2015$comuna_name <- gsub(" Del ", " del ", nesi_individuals_with_grants_2015$comuna_name)
nesi_individuals_with_grants_2015$comuna_name <- gsub(" La ", " la ", nesi_individuals_with_grants_2015$comuna_name)
nesi_individuals_with_grants_2015$comuna_name <- gsub(" Los ", " los ", nesi_individuals_with_grants_2015$comuna_name)
nesi_individuals_with_grants_2015$comuna_name <- gsub(" Y ", " y ", nesi_individuals_with_grants_2015$comuna_name)
nesi_individuals_with_grants_2015$occupational_situation <- gsub("\xe1", "\u00e1", nesi_individuals_with_grants_2015$occupational_situation) # a with acute
nesi_individuals_with_grants_2015$occupational_situation <- gsub("<e1>", "\u00e1", nesi_individuals_with_grants_2015$occupational_situation) # a with acute
nesi_individuals_with_grants_2015$icse <- gsub("\xe1", "\u00e1", nesi_individuals_with_grants_2015$icse) # a with acute
nesi_individuals_with_grants_2015$icse <- gsub("<e1>", "\u00e1", nesi_individuals_with_grants_2015$icse) # a with acute
nesi_individuals_with_grants_2015$icse <- gsub("<c1>", "\u00c1", nesi_individuals_with_grants_2015$icse) # A with acute
nesi_individuals_with_grants_2015$icse <- gsub("\xe9", "\u00e9", nesi_individuals_with_grants_2015$icse) # e with acute
nesi_individuals_with_grants_2015$icse <- gsub("<e9>", "\u00e9", nesi_individuals_with_grants_2015$icse) # e with acute
nesi_individuals_with_grants_2015$icse <- gsub("\xed", "\u00ed", nesi_individuals_with_grants_2015$icse) # i with acute
nesi_individuals_with_grants_2015$icse <- gsub("<ed>", "\u00ed", nesi_individuals_with_grants_2015$icse) # i with acute
nesi_individuals_with_grants_2015$icse <- gsub("\xf3", "\u00f3", nesi_individuals_with_grants_2015$icse) # o with acute
nesi_individuals_with_grants_2015$icse <- gsub("<f3>", "\u00f3", nesi_individuals_with_grants_2015$icse) # o with acute
nesi_individuals_with_grants_2015$icse <- gsub("\xfa", "\u00fa", nesi_individuals_with_grants_2015$icse) # u with acute
nesi_individuals_with_grants_2015$icse <- gsub("<fa>", "\u00fa", nesi_individuals_with_grants_2015$icse) # u with acute
nesi_individuals_with_grants_2015$icse <- gsub("\xda", "\u00da", nesi_individuals_with_grants_2015$icse) # U with acute
nesi_individuals_with_grants_2015$icse <- gsub("<da>", "\u00da", nesi_individuals_with_grants_2015$icse) # U with acute
nesi_individuals_with_grants_2015$icse <- gsub("\xf1", "\u00f1", nesi_individuals_with_grants_2015$icse) # n with tilde
nesi_individuals_with_grants_2015$icse <- gsub("<f1>", "\u00f1", nesi_individuals_with_grants_2015$icse) # n with tilde
nesi_individuals_with_grants_2015$icse <- gsub("\xfc\xbe\x8c\x96\x98\xbc", "\u00f1", nesi_individuals_with_grants_2015$icse) # n with tilde
nesi_individuals_with_grants_2015$icse <- gsub("\xd1", "\u00d1", nesi_individuals_with_grants_2015$icse) # N with tilde
nesi_individuals_with_grants_2015$icse <- gsub("<d1>", "\u00d1", nesi_individuals_with_grants_2015$icse) # N with tilde
nesi_individuals_with_grants_2015$icse <- gsub("\xfc\xbe\x8c\x96\x90\xbc", "\u00d1", nesi_individuals_with_grants_2015$icse) # N with tilde
nesi_individuals_with_grants_2015$isced <- gsub("\xe1", "\u00e1", nesi_individuals_with_grants_2015$isced) # a with acute
nesi_individuals_with_grants_2015$isced <- gsub("<e1>", "\u00e1", nesi_individuals_with_grants_2015$isced) # a with acute
nesi_individuals_with_grants_2015$isced <- gsub("<c1>", "\u00c1", nesi_individuals_with_grants_2015$isced) # A with acute
nesi_individuals_with_grants_2015$isced <- gsub("\xe9", "\u00e9", nesi_individuals_with_grants_2015$isced) # e with acute
nesi_individuals_with_grants_2015$isced <- gsub("<e9>", "\u00e9", nesi_individuals_with_grants_2015$isced) # e with acute
nesi_individuals_with_grants_2015$isced <- gsub("\xed", "\u00ed", nesi_individuals_with_grants_2015$isced) # i with acute
nesi_individuals_with_grants_2015$isced <- gsub("<ed>", "\u00ed", nesi_individuals_with_grants_2015$isced) # i with acute
nesi_individuals_with_grants_2015$isced <- gsub("\xf3", "\u00f3", nesi_individuals_with_grants_2015$isced) # o with acute
nesi_individuals_with_grants_2015$isced <- gsub("<f3>", "\u00f3", nesi_individuals_with_grants_2015$isced) # o with acute
nesi_individuals_with_grants_2015$isced <- gsub("\xfa", "\u00fa", nesi_individuals_with_grants_2015$isced) # u with acute
nesi_individuals_with_grants_2015$isced <- gsub("<fa>", "\u00fa", nesi_individuals_with_grants_2015$isced) # u with acute
nesi_individuals_with_grants_2015$isced <- gsub("\xda", "\u00da", nesi_individuals_with_grants_2015$isced) # U with acute
nesi_individuals_with_grants_2015$isced <- gsub("<da>", "\u00da", nesi_individuals_with_grants_2015$isced) # U with acute
nesi_individuals_with_grants_2015$isced <- gsub("\xf1", "\u00f1", nesi_individuals_with_grants_2015$isced) # n with tilde
nesi_individuals_with_grants_2015$isced <- gsub("<f1>", "\u00f1", nesi_individuals_with_grants_2015$isced) # n with tilde
nesi_individuals_with_grants_2015$isced <- gsub("\xfc\xbe\x8c\x96\x98\xbc", "\u00f1", nesi_individuals_with_grants_2015$isced) # n with tilde
nesi_individuals_with_grants_2015$isced <- gsub("\xd1", "\u00d1", nesi_individuals_with_grants_2015$isced) # N with tilde
nesi_individuals_with_grants_2015$isced <- gsub("<d1>", "\u00d1", nesi_individuals_with_grants_2015$isced) # N with tilde
nesi_individuals_with_grants_2015$isced <- gsub("\xfc\xbe\x8c\x96\x90\xbc", "\u00d1", nesi_individuals_with_grants_2015$isced) # N with tilde
nesi_individuals_with_grants_2015$isco <- gsub("\xe1", "\u00e1", nesi_individuals_with_grants_2015$isco) # a with acute
nesi_individuals_with_grants_2015$isco <- gsub("<e1>", "\u00e1", nesi_individuals_with_grants_2015$isco) # a with acute
nesi_individuals_with_grants_2015$isco <- gsub("<c1>", "\u00c1", nesi_individuals_with_grants_2015$isco) # A with acute
nesi_individuals_with_grants_2015$isco <- gsub("\xe9", "\u00e9", nesi_individuals_with_grants_2015$isco) # e with acute
nesi_individuals_with_grants_2015$isco <- gsub("<e9>", "\u00e9", nesi_individuals_with_grants_2015$isco) # e with acute
nesi_individuals_with_grants_2015$isco <- gsub("\xed", "\u00ed", nesi_individuals_with_grants_2015$isco) # i with acute
nesi_individuals_with_grants_2015$isco <- gsub("<ed>", "\u00ed", nesi_individuals_with_grants_2015$isco) # i with acute
nesi_individuals_with_grants_2015$isco <- gsub("\xf3", "\u00f3", nesi_individuals_with_grants_2015$isco) # o with acute
nesi_individuals_with_grants_2015$isco <- gsub("<f3>", "\u00f3", nesi_individuals_with_grants_2015$isco) # o with acute
nesi_individuals_with_grants_2015$isco <- gsub("\xfa", "\u00fa", nesi_individuals_with_grants_2015$isco) # u with acute
nesi_individuals_with_grants_2015$isco <- gsub("<fa>", "\u00fa", nesi_individuals_with_grants_2015$isco) # u with acute
nesi_individuals_with_grants_2015$isco <- gsub("\xda", "\u00da", nesi_individuals_with_grants_2015$isco) # U with acute
nesi_individuals_with_grants_2015$isco <- gsub("<da>", "\u00da", nesi_individuals_with_grants_2015$isco) # U with acute
nesi_individuals_with_grants_2015$isco <- gsub("\xf1", "\u00f1", nesi_individuals_with_grants_2015$isco) # n with tilde
nesi_individuals_with_grants_2015$isco <- gsub("<f1>", "\u00f1", nesi_individuals_with_grants_2015$isco) # n with tilde
nesi_individuals_with_grants_2015$isco <- gsub("\xfc\xbe\x8c\x96\x98\xbc", "\u00f1", nesi_individuals_with_grants_2015$isco) # n with tilde
nesi_individuals_with_grants_2015$isco <- gsub("\xd1", "\u00d1", nesi_individuals_with_grants_2015$isco) # N with tilde
nesi_individuals_with_grants_2015$isco <- gsub("<d1>", "\u00d1", nesi_individuals_with_grants_2015$isco) # N with tilde
nesi_individuals_with_grants_2015$isco <- gsub("\xfc\xbe\x8c\x96\x90\xbc", "\u00d1", nesi_individuals_with_grants_2015$isco) # N with tilde
# Fix comuna
nesi_individuals_with_grants_2015$comuna_name <- gsub("Los Alamos", "Los \u00c1lamos", nesi_individuals_with_grants_2015$comuna_name)
nesi_individuals_with_grants_2015$comuna_name <- gsub("Los Angeles", "Los \u00c1ngeles", nesi_individuals_with_grants_2015$comuna_name)
nesi_individuals_with_grants_2015$comuna_name <- gsub("Traiguen", "Traigu\u00e9n", nesi_individuals_with_grants_2015$comuna_name)
# Add region and provincia
nesi_individuals_with_grants_2015 <- move_col(nesi_individuals_with_grants_2015, c("comuna_name" = ncol(nesi_individuals_with_grants_2015)))
nesi_individuals_with_grants_2015 <- join(nesi_individuals_with_grants_2015, regiones_casen_2015, by = "comuna_name")
nesi_individuals_with_grants_2015 <- join(nesi_individuals_with_grants_2015, region_codes_datachile[,c("comuna_name","comuna_datachile_id","region_id")], by = "comuna_name")
nesi_individuals_with_grants_2015 <- join(nesi_individuals_with_grants_2015, provincia_codes_pacha[,c("provincia_name","provincia_pacha_id")], by = "provincia_name")
# Remove non-reported working hours
nesi_individuals_with_grants_2015[nesi_individuals_with_grants_2015$usual_working_hours == 0] <- NA
str(nesi_individuals_with_grants_2015$work_day)
names(nesi_individuals_with_grants_2015)
source("functions/load_functions.R")
source("functions/normalization.R")
source("functions/batch_load_data.R") #uncomment to recalculate from 0
source("process_wages_with_weights/process_wages_with_weights_2015.R")
source("process_wages_with_weights/process_wages_with_weights_2015.R")
nesi_individuals_with_grants_2015 <- nesi_individuals_with_grants_2015[,c("ING_T_P", "FACT_PER", "OCUP_REF", "SEXO", "R_P_C", "CISE", "CINE", "B1", "B14", "C1", "HABITUALES", "B15_1")]
nesi_individuals_with_grants_2015$year <- 2015
source("functions/load_functions.R")
source("functions/normalization.R")
source("functions/batch_load_data.R") #uncomment to recalculate from 0
source("process_wages_with_weights/process_wages_with_weights_2015.R")
source("functions/load_functions.R")
source("functions/normalization.R")
source("functions/batch_load_data.R") #uncomment to recalculate from 0
source("functions/load_functions.R")
source("functions/normalization.R")
source("functions/batch_load_data.R") #uncomment to recalculate from 0
source("process_wages_with_weights/process_wages_with_weights_2015.R")
source("process_wages_with_weights/process_wages_with_weights_2010.R")
source("functions/load_functions.R")
source("functions/normalization.R")
source("functions/batch_load_data.R") #uncomment to recalculate from 0
source("process_wages_with_weights/process_wages_with_weights_2015.R")
source("process_wages_with_weights/process_wages_with_weights_2010.R")
source("functions/load_functions.R")
source("functions/normalization.R")
source("functions/batch_load_data.R") #uncomment to recalculate from 0
source("process_wages_with_weights/process_wages_with_weights_2015.R")
source("process_wages_with_weights/process_wages_with_weights_2010.R")
labour_description_2010 <- nesi_individuals_with_grants_2010[,c("ING_T_P", "FACT_PER", "OCUP_REF", "SEXO", "R_P_C", "CISE", "CINE", "B1", "B14", "C1", "HABITUALES", "B15_1")]
nesi_individuals_with_grants_2010$ING_T_P
nesi_individuals_with_grants_2010$B14
nesi_individuals_with_grants_2010$c1
nesi_individuals_with_grants_2010$C1
nesi_individuals_with_grants_2010$HABITUALES
nesi_individuals_with_grants_2010$B15_1
source("process_wages_with_weights/process_wages_with_weights_2010.R")
source("functions/load_functions.R")
source("functions/normalization.R")
source("functions/batch_load_data.R") #uncomment to recalculate from 0
source("functions/load_functions.R")
source("functions/normalization.R")
source("functions/batch_load_data.R") #uncomment to recalculate from 0
source("process_wages_with_weights/process_wages_with_weights.R") #uncomment to recalculate from 0
source("functions/load_functions.R")
source("functions/normalization.R")
source("functions/batch_load_data.R") #uncomment to recalculate from 0
source("functions/load_functions.R")
source("functions/normalization.R")
source("functions/batch_load_data.R") #uncomment to recalculate from 0
source("functions/load_functions.R")
source("functions/normalization.R")
source("functions/batch_load_data.R") #uncomment to recalculate from 0
source("labour_situation/process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("functions/load_functions.R")
source("functions/normalization.R")
source("functions/batch_load_data.R") #uncomment to recalculate from 0
source("labour_situation/process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
#source("labour_situation/processed_labour_situation/1_load_labour_situation.R")
source("functions/load_functions.R")
source("functions/normalization.R")
#source("functions/batch_load_data.R") #uncomment to recalculate from 0
#source("labour_situation/process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("labour_situation/processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
source("functions/load_functions.R")
source("functions/normalization.R")
#source("functions/batch_load_data.R") #uncomment to recalculate from 0
#source("labour_situation/process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("labour_situation/processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
source("labour_situation/functions/load_functions.R")
source("labour_situation/functions/normalization.R")
#source("labour_situation/functions/batch_load_data.R") #uncomment to recalculate from 0
#source("labour_situation/process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("labour_situation/processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
source("labour_situation/functions/normalization.R")
source("labour_situation/functions/load_functions.R")
source("labour_situation/functions/normalization.R")
source("labour_situation/1_functions/1_load_functions.R")
source("labour_situation/1_functions/5_normalization.R")
source("labour_situation/1_functions/6_batch_load_data.R") #uncomment to recalculate from 0
source("labour_situation/2_process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("labour_situation/2_process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
getwd()
source("describe_dataset/1_functions/1_load_functions.R")
source("describe_dataset/1_functions/1_load_functions.R")
source("describe_dataset/1_functions/1_load_functions.R")
source("describe_dataset/1_functions/6_normalization.R")
names(nesi_2015)
names(nesi_individuals_with_grants_2015)
View(nesi_individuals_with_grants_2015)
load("~/datachile-etl/casen/casen_1990/casen_1990.RData")
View(casen_1990)
rm(casen_1990)
nesi_individuals_with_grants_2015$REG_T
nesi_individuals_with_grants_2015$REGION
drop <- c("REGION")
nesi_individuals_with_grants_2015 <- nesi_individuals_with_grants_2015[,!(names(nesi_individuals_with_grants_2015) %in% drop)]
############################################################
# Trim leading/ending whitespace + Fix characters/uppercase
############################################################
nesi_individuals_with_grants_2015$comuna <- gsub("(^|[[:space:]])([[:alpha:]])", "\\1\\U\\2", nesi_individuals_with_grants_2015$comuna, perl=TRUE)
nesi_individuals_with_grants_2015$comuna <- gsub("^\\s+|\\s+$", "", nesi_individuals_with_grants_2015$comuna)
###########################
# Fix characters/uppercase
###########################
nesi_individuals_with_grants_2015$comuna <- gsub("\xe1", "\u00e1", nesi_individuals_with_grants_2015$comuna) # a with acute
nesi_individuals_with_grants_2015$comuna <- gsub("<e1>", "\u00e1", nesi_individuals_with_grants_2015$comuna) # a with acute
nesi_individuals_with_grants_2015$comuna <- gsub("<c1>", "\u00c1", nesi_individuals_with_grants_2015$comuna) # A with acute
nesi_individuals_with_grants_2015$comuna <- gsub("\xe9", "\u00e9", nesi_individuals_with_grants_2015$comuna) # e with acute
nesi_individuals_with_grants_2015$comuna <- gsub("<e9>", "\u00e9", nesi_individuals_with_grants_2015$comuna) # e with acute
nesi_individuals_with_grants_2015$comuna <- gsub("\xed", "\u00ed", nesi_individuals_with_grants_2015$comuna) # i with acute
nesi_individuals_with_grants_2015$comuna <- gsub("<ed>", "\u00ed", nesi_individuals_with_grants_2015$comuna) # i with acute
nesi_individuals_with_grants_2015$comuna <- gsub("\xf3", "\u00f3", nesi_individuals_with_grants_2015$comuna) # o with acute
nesi_individuals_with_grants_2015$comuna <- gsub("<f3>", "\u00f3", nesi_individuals_with_grants_2015$comuna) # o with acute
nesi_individuals_with_grants_2015$comuna <- gsub("\xfa", "\u00fa", nesi_individuals_with_grants_2015$comuna) # u with acute
nesi_individuals_with_grants_2015$comuna <- gsub("<fa>", "\u00fa", nesi_individuals_with_grants_2015$comuna) # u with acute
nesi_individuals_with_grants_2015$comuna <- gsub("\xda", "\u00da", nesi_individuals_with_grants_2015$comuna) # U with acute
nesi_individuals_with_grants_2015$comuna <- gsub("<da>", "\u00da", nesi_individuals_with_grants_2015$comuna) # U with acute
nesi_individuals_with_grants_2015$comuna <- gsub("\xf1", "\u00f1", nesi_individuals_with_grants_2015$comuna) # n with tilde
nesi_individuals_with_grants_2015$comuna <- gsub("<f1>", "\u00f1", nesi_individuals_with_grants_2015$comuna) # n with tilde
nesi_individuals_with_grants_2015$comuna <- gsub("\xfc\xbe\x8c\x96\x98\xbc", "\u00f1", nesi_individuals_with_grants_2015$comuna) # n with tilde
nesi_individuals_with_grants_2015$comuna <- gsub("\xd1", "\u00d1", nesi_individuals_with_grants_2015$comuna) # N with tilde
nesi_individuals_with_grants_2015$comuna <- gsub("<d1>", "\u00d1", nesi_individuals_with_grants_2015$comuna) # N with tilde
nesi_individuals_with_grants_2015$comuna <- gsub("\xfc\xbe\x8c\x96\x90\xbc", "\u00d1", nesi_individuals_with_grants_2015$comuna) # N with tilde
nesi_individuals_with_grants_2015$comuna <- gsub("\xb4", "\u0027", nesi_individuals_with_grants_2015$comuna) # apostrophe
nesi_individuals_with_grants_2015$comuna <- gsub("<b4>", "\u0027", nesi_individuals_with_grants_2015$comuna) # apostrophe
nesi_individuals_with_grants_2015$comuna <- gsub(" De ", " de ", nesi_individuals_with_grants_2015$comuna)
nesi_individuals_with_grants_2015$comuna <- gsub(" Del ", " del ", nesi_individuals_with_grants_2015$comuna)
nesi_individuals_with_grants_2015$comuna <- gsub(" La ", " la ", nesi_individuals_with_grants_2015$comuna)
nesi_individuals_with_grants_2015$comuna <- gsub(" Los ", " los ", nesi_individuals_with_grants_2015$comuna)
nesi_individuals_with_grants_2015$comuna <- gsub(" Y ", " y ", nesi_individuals_with_grants_2015$comuna)
nesi_individuals_with_grants_2015$R_P_C
source("describe_dataset/1_functions/1_load_functions.R")
source("describe_dataset/1_functions/6_normalization.R")
drop <- c("REGION")
nesi_individuals_with_grants_2015 <- nesi_individuals_with_grants_2015[,!(names(nesi_individuals_with_grants_2015) %in% drop)]
nesi_individuals_with_grants_2015$R_P_C <- gsub("(^|[[:space:]])([[:alpha:]])", "\\1\\U\\2", nesi_individuals_with_grants_2015$R_P_C, perl=TRUE)
nesi_individuals_with_grants_2015$R_P_C <- gsub("^\\s+|\\s+$", "", nesi_individuals_with_grants_2015$R_P_C)
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xe1", "\u00e1", nesi_individuals_with_grants_2015$R_P_C) # a with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<e1>", "\u00e1", nesi_individuals_with_grants_2015$R_P_C) # a with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<c1>", "\u00c1", nesi_individuals_with_grants_2015$R_P_C) # A with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xe9", "\u00e9", nesi_individuals_with_grants_2015$R_P_C) # e with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<e9>", "\u00e9", nesi_individuals_with_grants_2015$R_P_C) # e with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xed", "\u00ed", nesi_individuals_with_grants_2015$R_P_C) # i with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<ed>", "\u00ed", nesi_individuals_with_grants_2015$R_P_C) # i with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xf3", "\u00f3", nesi_individuals_with_grants_2015$R_P_C) # o with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<f3>", "\u00f3", nesi_individuals_with_grants_2015$R_P_C) # o with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xfa", "\u00fa", nesi_individuals_with_grants_2015$R_P_C) # u with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<fa>", "\u00fa", nesi_individuals_with_grants_2015$R_P_C) # u with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xda", "\u00da", nesi_individuals_with_grants_2015$R_P_C) # U with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<da>", "\u00da", nesi_individuals_with_grants_2015$R_P_C) # U with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xf1", "\u00f1", nesi_individuals_with_grants_2015$R_P_C) # n with tilde
nesi_individuals_with_grants_2015$R_P_C <- gsub("<f1>", "\u00f1", nesi_individuals_with_grants_2015$R_P_C) # n with tilde
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xfc\xbe\x8c\x96\x98\xbc", "\u00f1", nesi_individuals_with_grants_2015$R_P_C) # n with tilde
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xd1", "\u00d1", nesi_individuals_with_grants_2015$R_P_C) # N with tilde
nesi_individuals_with_grants_2015$R_P_C <- gsub("<d1>", "\u00d1", nesi_individuals_with_grants_2015$R_P_C) # N with tilde
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xfc\xbe\x8c\x96\x90\xbc", "\u00d1", nesi_individuals_with_grants_2015$R_P_C) # N with tilde
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xb4", "\u0027", nesi_individuals_with_grants_2015$R_P_C) # apostrophe
nesi_individuals_with_grants_2015$R_P_C <- gsub("<b4>", "\u0027", nesi_individuals_with_grants_2015$R_P_C) # apostrophe
nesi_individuals_with_grants_2015$R_P_C <- gsub(" De ", " de ", nesi_individuals_with_grants_2015$R_P_C)
nesi_individuals_with_grants_2015$R_P_C <- gsub(" Del ", " del ", nesi_individuals_with_grants_2015$R_P_C)
nesi_individuals_with_grants_2015$R_P_C <- gsub(" La ", " la ", nesi_individuals_with_grants_2015$R_P_C)
nesi_individuals_with_grants_2015$R_P_C <- gsub(" Los ", " los ", nesi_individuals_with_grants_2015$R_P_C)
nesi_individuals_with_grants_2015$R_P_C <- gsub(" Y ", " y ", nesi_individuals_with_grants_2015$R_P_C)
source("describe_dataset/1_functions/1_load_functions.R")
source("describe_dataset/1_functions/6_normalization.R")
source("describe_dataset/2_clean/1_clean_2015.R")
getwd()
source("describe_dataset/1_functions/1_load_functions.R")
source("describe_dataset/1_functions/6_normalization.R")
source("describe_dataset/1_functions/1_load_functions.R")
source("describe_dataset/1_functions/6_normalization.R")
#########################
# Drop region and comuna
#########################
drop <- c("REGION")
nesi_individuals_with_grants_2015 <- nesi_individuals_with_grants_2015[,!(names(nesi_individuals_with_grants_2015) %in% drop)]
############################################################
# Trim leading/ending whitespace + Fix characters/uppercase
############################################################
nesi_individuals_with_grants_2015$R_P_C <- gsub("(^|[[:space:]])([[:alpha:]])", "\\1\\U\\2", nesi_individuals_with_grants_2015$R_P_C, perl=TRUE)
nesi_individuals_with_grants_2015$R_P_C <- gsub("^\\s+|\\s+$", "", nesi_individuals_with_grants_2015$R_P_C)
###########################
# Fix characters/uppercase
###########################
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xe1", "\u00e1", nesi_individuals_with_grants_2015$R_P_C) # a with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<e1>", "\u00e1", nesi_individuals_with_grants_2015$R_P_C) # a with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<c1>", "\u00c1", nesi_individuals_with_grants_2015$R_P_C) # A with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xe9", "\u00e9", nesi_individuals_with_grants_2015$R_P_C) # e with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<e9>", "\u00e9", nesi_individuals_with_grants_2015$R_P_C) # e with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xed", "\u00ed", nesi_individuals_with_grants_2015$R_P_C) # i with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<ed>", "\u00ed", nesi_individuals_with_grants_2015$R_P_C) # i with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xf3", "\u00f3", nesi_individuals_with_grants_2015$R_P_C) # o with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<f3>", "\u00f3", nesi_individuals_with_grants_2015$R_P_C) # o with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xfa", "\u00fa", nesi_individuals_with_grants_2015$R_P_C) # u with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<fa>", "\u00fa", nesi_individuals_with_grants_2015$R_P_C) # u with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xda", "\u00da", nesi_individuals_with_grants_2015$R_P_C) # U with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("<da>", "\u00da", nesi_individuals_with_grants_2015$R_P_C) # U with acute
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xf1", "\u00f1", nesi_individuals_with_grants_2015$R_P_C) # n with tilde
nesi_individuals_with_grants_2015$R_P_C <- gsub("<f1>", "\u00f1", nesi_individuals_with_grants_2015$R_P_C) # n with tilde
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xfc\xbe\x8c\x96\x98\xbc", "\u00f1", nesi_individuals_with_grants_2015$R_P_C) # n with tilde
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xd1", "\u00d1", nesi_individuals_with_grants_2015$R_P_C) # N with tilde
nesi_individuals_with_grants_2015$R_P_C <- gsub("<d1>", "\u00d1", nesi_individuals_with_grants_2015$R_P_C) # N with tilde
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xfc\xbe\x8c\x96\x90\xbc", "\u00d1", nesi_individuals_with_grants_2015$R_P_C) # N with tilde
nesi_individuals_with_grants_2015$R_P_C <- gsub("\xb4", "\u0027", nesi_individuals_with_grants_2015$R_P_C) # apostrophe
nesi_individuals_with_grants_2015$R_P_C <- gsub("<b4>", "\u0027", nesi_individuals_with_grants_2015$R_P_C) # apostrophe
nesi_individuals_with_grants_2015$R_P_C <- gsub(" De ", " de ", nesi_individuals_with_grants_2015$R_P_C)
nesi_individuals_with_grants_2015$R_P_C <- gsub(" Del ", " del ", nesi_individuals_with_grants_2015$R_P_C)
nesi_individuals_with_grants_2015$R_P_C <- gsub(" La ", " la ", nesi_individuals_with_grants_2015$R_P_C)
nesi_individuals_with_grants_2015$R_P_C <- gsub(" Los ", " los ", nesi_individuals_with_grants_2015$R_P_C)
nesi_individuals_with_grants_2015$R_P_C <- gsub(" Y ", " y ", nesi_individuals_with_grants_2015$R_P_C)
unique(nesi_individuals_with_grants_2015$R_P_C)
nesi_individuals_with_grants_2015$R_P_C <- gsub("Alto Biob\u00edo", "Alto B\u00edob\u00edo", nesi_individuals_with_grants_2015$R_P_C)
nesi_individuals_with_grants_2015$R_P_C <- gsub("Los Alamos", "Los \u00c1lamos", nesi_individuals_with_grants_2015$R_P_C)
nesi_individuals_with_grants_2015$R_P_C <- gsub("Los Angeles", "Los \u00c1ngeles", nesi_individuals_with_grants_2015$R_P_C)
unique(nesi_individuals_with_grants_2015$R_P_C)
x <- as.data.frame(unique(nesi_individuals_with_grants_2015$R_P_C))
View(x)
rm(x)
nesi_individuals_with_grants_2015$year <- 2015
nesi_individuals_with_grants_2015_desc_1 <- nesi_individuals_with_grants_2015 %>% group_by(year) %>% summarise_each(funs(sum(is.na(.) | .==0 | .=="" | .==" ")))
nesi_individuals_with_grants_2015_desc_2 <- nesi_individuals_with_grants_2015 %>% group_by(year) %>% summarise_each(funs(sum(!(is.na(.) | .==0 | .=="" | .==" "))))
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_1[,-1]
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_2[,-1]/(nesi_individuals_with_grants_2015_desc_1[,-1]+nesi_individuals_with_grants_2015_desc_2[,-1])
nesi_individuals_with_grants_2015_desc <- round(nesi_individuals_with_grants_2015_desc, digits = 4)
nesi_individuals_with_grants_2015_desc <- as.data.frame(nesi_individuals_with_grants_2015_desc)
nesi_individuals_with_grants_2015_desc <- as.data.frame(t(nesi_individuals_with_grants_2015_desc))
setnames(nesi_individuals_with_grants_2015_desc, colnames(nesi_individuals_with_grants_2015_desc), "reply_ratio_2015")
#######
variables_2015 <- rownames(nesi_individuals_with_grants_2015_desc)
variables_2013 <- colnames(nesi_individuals_with_grants_2013)
variables_2011 <- colnames(nesi_individuals_with_grants_2011)
variables_2009 <- colnames(nesi_individuals_with_grants_2009)
variables_2006 <- colnames(nesi_individuals_with_grants_2006)
variables_2003 <- colnames(nesi_individuals_with_grants_2003)
variables_2000 <- colnames(nesi_individuals_with_grants_2000)
variables_1998 <- colnames(nesi_individuals_with_grants_1998)
variables_1996 <- colnames(nesi_individuals_with_grants_1996)
variables_1994 <- colnames(nesi_individuals_with_grants_1994)
variables_1992 <- colnames(nesi_individuals_with_grants_1992)
variables_1990 <- colnames(nesi_individuals_with_grants_1990)
#######
nesi_individuals_with_grants_2015_desc$available_2013 <- ifelse(variables_2015 %in% variables_2013, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2011 <- ifelse(variables_2015 %in% variables_2011, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2009 <- ifelse(variables_2015 %in% variables_2009, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2006 <- ifelse(variables_2015 %in% variables_2006, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2003 <- ifelse(variables_2015 %in% variables_2003, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2000 <- ifelse(variables_2015 %in% variables_2000, 1, 0)
nesi_individuals_with_grants_2015_desc$available_1998 <- ifelse(variables_2015 %in% variables_1998, 1, 0)
nesi_individuals_with_grants_2015_desc$available_1996 <- ifelse(variables_2015 %in% variables_1996, 1, 0)
nesi_individuals_with_grants_2015_desc$available_1994 <- ifelse(variables_2015 %in% variables_1994, 1, 0)
nesi_individuals_with_grants_2015_desc$available_1992 <- ifelse(variables_2015 %in% variables_1992, 1, 0)
nesi_individuals_with_grants_2015_desc$available_1990 <- ifelse(variables_2015 %in% variables_1990, 1, 0)
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_1[,-1]
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_2[,-1]/(nesi_individuals_with_grants_2015_desc_1[,-1]+nesi_individuals_with_grants_2015_desc_2[,-1])
nesi_individuals_with_grants_2015_desc <- round(nesi_individuals_with_grants_2015_desc, digits = 4)
nesi_individuals_with_grants_2015_desc <- as.data.frame(nesi_individuals_with_grants_2015_desc)
nesi_individuals_with_grants_2015_desc <- as.data.frame(t(nesi_individuals_with_grants_2015_desc))
setnames(nesi_individuals_with_grants_2015_desc, colnames(nesi_individuals_with_grants_2015_desc), "reply_ratio_2015")
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_1[,-1]
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_2[,-1]/(nesi_individuals_with_grants_2015_desc_1[,-1]+nesi_individuals_with_grants_2015_desc_2[,-1])
nesi_individuals_with_grants_2015_desc <- round(nesi_individuals_with_grants_2015_desc, digits = 4)
nesi_individuals_with_grants_2015_desc <- as.data.frame(nesi_individuals_with_grants_2015_desc)
nesi_individuals_with_grants_2015_desc <- as.data.frame(t(nesi_individuals_with_grants_2015_desc))
setnames(nesi_individuals_with_grants_2015_desc, colnames(nesi_individuals_with_grants_2015_desc), "reply_ratio_2015")
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_1[,-1]
nesi_individuals_with_grants_2015_desc <- nesi_individuals_with_grants_2015_desc_2[,-1]/(nesi_individuals_with_grants_2015_desc_1[,-1]+nesi_individuals_with_grants_2015_desc_2[,-1])
nesi_individuals_with_grants_2015_desc <- round(nesi_individuals_with_grants_2015_desc, digits = 4)
nesi_individuals_with_grants_2015_desc <- as.data.frame(nesi_individuals_with_grants_2015_desc)
nesi_individuals_with_grants_2015_desc <- as.data.frame(t(nesi_individuals_with_grants_2015_desc))
setnames(nesi_individuals_with_grants_2015_desc, colnames(nesi_individuals_with_grants_2015_desc), "reply_ratio_2015")
variables_2015 <- rownames(nesi_individuals_with_grants_2015_desc)
variables_2014 <- colnames(nesi_individuals_with_grants_2014)
variables_2013 <- colnames(nesi_individuals_with_grants_2013)
variables_2012 <- colnames(nesi_individuals_with_grants_2012)
variables_2011 <- colnames(nesi_individuals_with_grants_2011)
variables_2010 <- colnames(nesi_individuals_with_grants_2010)
nesi_individuals_with_grants_2015_desc$available_2014 <- ifelse(variables_2015 %in% variables_2014, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2013 <- ifelse(variables_2015 %in% variables_2013, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2012 <- ifelse(variables_2015 %in% variables_2012, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2011 <- ifelse(variables_2015 %in% variables_2011, 1, 0)
nesi_individuals_with_grants_2015_desc$available_2010 <- ifelse(variables_2015 %in% variables_2010, 1, 0)
write.csv(nesi_individuals_with_grants_2015_desc, file = "describe_dataset/4_csv_files/aggregate_description_2015.csv")
source("describe_dataset/3_description/aggregate_description.R")
source("describe_dataset/1_functions/1_load_functions.R")
source("describe_dataset/1_functions/6_normalization.R")
source("describe_dataset/2_clean/1_clean_2015.R")
source("describe_dataset/1_functions/1_load_functions.R")
source("describe_dataset/1_functions/6_normalization.R")
source("describe_dataset/2_clean/1_clean_2015.R")
nesi_individuals_with_grants_2015_c_1 <- nesi_individuals_with_grants_2015 %>% group_by(R_P_C) %>% summarise_each(funs(sum(is.na(.) | .==0 | .=="" | .==" ")))
nesi_individuals_with_grants_2015_c_1
names(nesi_individuals_with_grants_2015_c_1)
setnames(nesi_individuals_with_grants_2015_c_1, "R_P_C", "comuna_name")
nesi_individuals_with_grants_2015_p_1 <- nesi_individuals_with_grants_2015_c_1
nesi_individuals_with_grants_2015_p_1 <- join(nesi_individuals_with_grants_2015_p_1, regiones_nesi_individuals_with_grants_2015[,c("comuna_name","provincia_name")], by = "comuna_name")
nesi_individuals_with_grants_2015_p_1 <- move_col(nesi_individuals_with_grants_2015_p_1, c("provincia_name"=1))
nesi_individuals_with_grants_2015_p_1 <- nesi_individuals_with_grants_2015_p_1[,!(names(nesi_individuals_with_grants_2015_p_1) %in% "comuna_name")]
nesi_individuals_with_grants_2015_p_1 <- ddply(nesi_individuals_with_grants_2015_p_1, "provincia_name", numcolwise(sum))
nesi_individuals_with_grants_2015_p_1 <- nesi_individuals_with_grants_2015_c_1
nesi_individuals_with_grants_2015_p_1 <- join(nesi_individuals_with_grants_2015_p_1, regiones_nesi_individuals_with_grants_2015[,c("comuna_name","provincia_name")], by = "comuna_name")
View(region_codes_datachile)
nesi_individuals_with_grants_2015_p_1 <- join(nesi_individuals_with_grants_2015_p_1, regiones_casen_2015[,c("comuna_name","provincia_name")], by = "comuna_name")
source("describe_dataset/1_functions/1_load_functions.R")
source("describe_dataset/1_functions/6_normalization.R")
source("describe_dataset/2_clean/1_clean_2015.R")
nesi_individuals_with_grants_2015_c_1 <- nesi_individuals_with_grants_2015 %>% group_by(R_P_C) %>% summarise_each(funs(sum(is.na(.) | .==0 | .=="" | .==" ")))
setnames(nesi_individuals_with_grants_2015_c_1, "R_P_C", "comuna_name")
#########################
## aggregate by provincia
#########################
nesi_individuals_with_grants_2015_p_1 <- nesi_individuals_with_grants_2015_c_1
nesi_individuals_with_grants_2015_p_1 <- join(nesi_individuals_with_grants_2015_p_1, regiones_casen_2015[,c("comuna_name","provincia_name")], by = "comuna_name")
nesi_individuals_with_grants_2015_p_1 <- move_col(nesi_individuals_with_grants_2015_p_1, c("provincia_name"=1))
nesi_individuals_with_grants_2015_p_1 <- nesi_individuals_with_grants_2015_p_1[,!(names(nesi_individuals_with_grants_2015_p_1) %in% "comuna_name")]
nesi_individuals_with_grants_2015_p_1 <- ddply(nesi_individuals_with_grants_2015_p_1, "provincia_name", numcolwise(sum))
nesi_individuals_with_grants_2015_r_1 <- nesi_individuals_with_grants_2015_c_1
nesi_individuals_with_grants_2015_r_1 <- join(nesi_individuals_with_grants_2015_r_1, regiones_casen_2015[,c("comuna_name","region_name")], by = "comuna_name")
nesi_individuals_with_grants_2015_r_1 <- move_col(nesi_individuals_with_grants_2015_r_1, c("region_name"=1))
nesi_individuals_with_grants_2015_r_1 <- nesi_individuals_with_grants_2015_r_1[,!(names(nesi_individuals_with_grants_2015_r_1) %in% "comuna_name")]
nesi_individuals_with_grants_2015_r_1 <- ddply(nesi_individuals_with_grants_2015_r_1, "region_name", numcolwise(sum))
nesi_individuals_with_grants_2015_c_2 <- nesi_individuals_with_grants_2015 %>% group_by(comuna) %>% summarise_each(funs(sum(!(is.na(.) | .==0 | .=="" | .==" "))))
setnames(nesi_individuals_with_grants_2015_c_2, "R_P_C", "comuna_name")
nesi_individuals_with_grants_2015_c_2 <- nesi_individuals_with_grants_2015 %>% group_by(R_P_C) %>% summarise_each(funs(sum(!(is.na(.) | .==0 | .=="" | .==" "))))
setnames(nesi_individuals_with_grants_2015_c_2, "R_P_C", "comuna_name")
nesi_individuals_with_grants_2015_p_2 <- nesi_individuals_with_grants_2015_c_2
nesi_individuals_with_grants_2015_p_2 <- join(nesi_individuals_with_grants_2015_p_2, regiones_casen_2015[,c("comuna_name","provincia_name")], by = "comuna_name")
nesi_individuals_with_grants_2015_p_2 <- move_col(nesi_individuals_with_grants_2015_p_2, c("provincia_name"=1))
nesi_individuals_with_grants_2015_p_2 <- nesi_individuals_with_grants_2015_p_2[,!(names(nesi_individuals_with_grants_2015_p_2) %in% "comuna_name")]
nesi_individuals_with_grants_2015_p_2 <- ddply(nesi_individuals_with_grants_2015_p_2, "provincia_name", numcolwise(sum))
nesi_individuals_with_grants_2015_r_2 <- nesi_individuals_with_grants_2015_c_2
nesi_individuals_with_grants_2015_r_2 <- join(nesi_individuals_with_grants_2015_r_2, regiones_casen_2015[,c("comuna_name","region_name")], by = "comuna_name")
nesi_individuals_with_grants_2015_r_2 <- move_col(nesi_individuals_with_grants_2015_r_2, c("region_name"=1))
nesi_individuals_with_grants_2015_r_2 <- nesi_individuals_with_grants_2015_r_2[,!(names(nesi_individuals_with_grants_2015_r_2) %in% "comuna_name")]
nesi_individuals_with_grants_2015_r_2 <- ddply(nesi_individuals_with_grants_2015_r_2, "region_name", numcolwise(sum))
nesi_individuals_with_grants_2015_c_pcent <- nesi_individuals_with_grants_2015_c_2
nesi_individuals_with_grants_2015_c_pcent[,-1] <- nesi_individuals_with_grants_2015_c_2[,-1]/(nesi_individuals_with_grants_2015_c_1[,-1]+nesi_individuals_with_grants_2015_c_2[,-1])
nesi_individuals_with_grants_2015_c_pcent[,-1] <- round(nesi_individuals_with_grants_2015_c_pcent[,-1], digits = 4)
setnames(nesi_individuals_with_grants_2015_c_pcent, "comuna_name", "geography_name")
nesi_individuals_with_grants_2015_c_pcent$geography_division <- "comuna"
nesi_individuals_with_grants_2015_c_pcent <- move_col(nesi_individuals_with_grants_2015_c_pcent, c("geography_division"=1))
nesi_individuals_with_grants_2015_p_pcent <- nesi_individuals_with_grants_2015_p_2
nesi_individuals_with_grants_2015_p_pcent[,-1] <- nesi_individuals_with_grants_2015_p_2[,-1]/(nesi_individuals_with_grants_2015_p_1[,-1]+nesi_individuals_with_grants_2015_p_2[,-1])
nesi_individuals_with_grants_2015_p_pcent[,-1] <- round(nesi_individuals_with_grants_2015_p_pcent[,-1], digits = 4)
setnames(nesi_individuals_with_grants_2015_p_pcent, "provincia_name", "geography_name")
nesi_individuals_with_grants_2015_p_pcent$geography_division <- "provincia"
nesi_individuals_with_grants_2015_p_pcent <- move_col(nesi_individuals_with_grants_2015_p_pcent, c("geography_division"=1))
nesi_individuals_with_grants_2015_r_pcent <- nesi_individuals_with_grants_2015_r_2
nesi_individuals_with_grants_2015_r_pcent[,-1] <- nesi_individuals_with_grants_2015_r_2[,-1]/(nesi_individuals_with_grants_2015_r_1[,-1]+nesi_individuals_with_grants_2015_r_2[,-1])
nesi_individuals_with_grants_2015_r_pcent[,-1] <- round(nesi_individuals_with_grants_2015_r_pcent[,-1], digits = 4)
setnames(nesi_individuals_with_grants_2015_r_pcent, "region_name", "geography_name")
nesi_individuals_with_grants_2015_r_pcent$geography_division <- "region"
nesi_individuals_with_grants_2015_r_pcent <- move_col(nesi_individuals_with_grants_2015_r_pcent, c("geography_division"=1))
nesi_individuals_with_grants_2015_all_pcent <- rbind(nesi_individuals_with_grants_2015_c_pcent,nesi_individuals_with_grants_2015_p_pcent,nesi_individuals_with_grants_2015_r_pcent)
nesi_individuals_with_grants_2015_all_pcent[nesi_individuals_with_grants_2015_all_pcent < 0] <- 0
nesi_individuals_with_grants_2015_c_count <- nesi_individuals_with_grants_2015_c_2
nesi_individuals_with_grants_2015_c_count$geography_division <- "comuna"
nesi_individuals_with_grants_2015_c_count <- move_col(nesi_individuals_with_grants_2015_c_count, c("geography_division"=1))
nesi_individuals_with_grants_2015_p_count <- nesi_individuals_with_grants_2015_p_2
nesi_individuals_with_grants_2015_p_count$geography_division <- "provincia"
nesi_individuals_with_grants_2015_p_count <- move_col(nesi_individuals_with_grants_2015_p_count, c("geography_division"=1))
nesi_individuals_with_grants_2015_r_count <- nesi_individuals_with_grants_2015_r_2
nesi_individuals_with_grants_2015_r_count$geography_division <- "region"
nesi_individuals_with_grants_2015_r_count <- move_col(nesi_individuals_with_grants_2015_r_count, c("geography_division"=1))
nesi_individuals_with_grants_2015_all_count <- rbind(nesi_individuals_with_grants_2015_c_count,nesi_individuals_with_grants_2015_p_count,nesi_individuals_with_grants_2015_r_count)
write.csv(nesi_individuals_with_grants_2015_all_pcent, file = "describe_dataset/4_csv_files/geographical_description_percentages_2015.csv")
write.csv(nesi_individuals_with_grants_2015_all_count, file = "describe_dataset/4_csv_files/geographical_description_count_2015.csv")
load("nesi_2015/individuals/nesi_individuals_with_grants_2015.RData")
View(nesi_individuals_with_grants_2015)
libraries <- c("foreign","httr", "data.table", "stringr")
load("nesi_2015/individuals/nesi_individuals_with_grants_2015.RData")
questions_labels <- as.data.frame(attributes(nesi_individuals_with_grants_2015)$variable.labels)
View(questions_labels)
write.csv(questions_labels, file = "describe_dataset/4_csv_files/questions_labels_2015.csv")
source("labour_situation/1_functions/1_load_functions.R")
source("labour_situation/1_functions/5_normalization.R")
source("labour_situation/1_functions/6_batch_load_data.R") #uncomment to recalculate from 0
source("labour_situation/2_process_labour_situation/1_process_labour_situation.R") #uncomment to recalculate from 0
View(labour_description_2015)
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
source("labour_situation/3_processed_labour_situation/1_load_labour_situation.R") #comment when recalculating
View(labour_description_2015)
summary_2015 <- ddply(labour_description_2015, .(sex,isic), summarise, FUN = matrixStats::weightedMean(wage, w = weigth, na.rm = TRUE))
summary_2015 <- ddply(labour_description_2015, .(sex,isic), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
summary_2015
summary_2015 <- ddply(labour_description_2015, .(sex,isic), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
getwd()
write.csv(summary_2015, file = "summary_sex_isic_2015.csv")
summary_2015_2 <- ddply(labour_description_2015, .(sex,work_day), summarise, FUN = matrixStats::weightedMean(wage, w = weight, na.rm = TRUE))
write.csv(summary_2015_2, file = "summary_sex_work_day_2015.csv")
summary_2015_3 <- ddply(labour_description_2015, .(sex,work_day), summarise, FUN = sum)
write.csv(summary_2015_3, file = "summary_sex_work_day_count_2015.csv")
summary_2015_3 <- ddply(labour_description_2015, .(sex,work_day), summarise, FUN = sum)
summary_2015_3 <- ddply(labour_description_2015, .(sex,work_day), summarise, FUN = count)
summary_2015_3 <- ddply(labour_description_2015, .(sex,work_day), summarise, FUN = sum)
summary_2015_3 <- aggregate(sex ~ work_day, labour_description_2015, FUN = sum)
summary_2015_3 <- aggregate(work_day ~ sex, labour_description_2015, FUN = sum)
labour_description_2015$uno <- 1
labour_description_2015$uno <- 1
summary_2015_3 <- aggregate(uno ~ sex + work_day, labour_description_2015, FUN = sum)
write.csv(summary_2015_3, file = "summary_sex_work_day_count_2015.csv")
summary_2015_3
